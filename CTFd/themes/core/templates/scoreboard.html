{% extends "base.html" %}

{% block content %}
<!-- Replaced jumbotron with modern hero section and live updates indicator -->
<div class="bg-gradient-to-br from-accent/5 to-primary/5 py-16">
  <div class="container mx-auto px-4">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
      <div>
        <h1 class="font-heading font-bold text-4xl text-foreground mb-4">
          {% trans %}Scoreboard{% endtrans %}
        </h1>
        <p class="text-muted-foreground text-lg">
          {% trans %}Live rankings and competition standings{% endtrans %}
        </p>
      </div>
      
      <!-- Live update indicator -->
      <div class="mt-6 md:mt-0 flex items-center space-x-2 text-sm">
        <div class="w-2 h-2 bg-accent rounded-full animate-pulse"></div>
        <span class="text-muted-foreground">{% trans %}Live Updates{% endtrans %}</span>
      </div>
    </div>
  </div>
</div>

<div class="py-8">
  <div class="container mx-auto px-4">
    {% include "components/errors.html" %}

    <!-- Modern score graph section with better loading state -->
    <div id="score-graph" 
         class="mb-8" 
         :class="{'block': show, 'hidden': !show}" 
         x-data="ScoreboardDetail" 
         x-ref="scoregraph" 
         @bracket-change.window="activeBracket=$event.detail; update();">
      <div class="ctf-card p-8">
        <div class="flex items-center justify-center min-h-64">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-4"></div>
            <p class="text-muted-foreground">{% trans %}Loading score graph...{% endtrans %}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Redesigned scoreboard with modern cards and better data visualization -->
    <div id="scoreboard" x-data="ScoreboardList">
      <!-- Bracket navigation with modern pill design -->
      <template x-if="brackets.length && standings.length">
        <div class="mb-8">
          <div class="ctf-card p-6">
            <h3 class="font-heading font-semibold text-lg mb-4">{% trans %}Competition Brackets{% endtrans %}</h3>
            <div class="flex flex-wrap gap-2">
              <button 
                class="px-4 py-2 rounded-full text-sm font-medium transition-colors"
                :class="!activeBracket ? 'bg-primary text-primary-foreground' : 'bg-muted text-muted-foreground hover:bg-muted/80'"
                @click="activeBracket=null">
                {% trans %}All Participants{% endtrans %}
              </button>
              <template x-for="bracket in brackets" :key="bracket.id">
                <button 
                  class="px-4 py-2 rounded-full text-sm font-medium transition-colors"
                  :class="activeBracket == bracket.id ? 'bg-primary text-primary-foreground' : 'bg-muted text-muted-foreground hover:bg-muted/80'"
                  x-text="bracket.name" 
                  @click="activeBracket=bracket.id">
                </button>
              </template>
            </div>
          </div>
        </div>
      </template>

      <!-- Modern scoreboard table -->
      <div x-show="standings.length">
        <div class="ctf-card overflow-hidden">
          <!-- Table header -->
          <div class="bg-muted/30 px-6 py-4 border-b border-border">
            <h3 class="font-heading font-semibold text-lg">{% trans %}Current Rankings{% endtrans %}</h3>
          </div>
          
          <!-- Responsive table -->
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-muted/10">
                <tr class="border-b border-border">
                  <th class="px-6 py-4 text-left text-sm font-medium text-muted-foreground w-20">
                    {% trans %}Rank{% endtrans %}
                  </th>
                  <th class="px-6 py-4 text-left text-sm font-medium text-muted-foreground">
                    {{ get_mode_as_word(capitalize=True) }}
                  </th>
                  <th class="px-6 py-4 text-center text-sm font-medium text-muted-foreground w-32">
                    {% trans %}Score{% endtrans %}
                  </th>
                  <th class="px-6 py-4 text-center text-sm font-medium text-muted-foreground w-32">
                    {% trans %}Solves{% endtrans %}
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-border">
                <template x-for="(standing, index) in standings.filter(i => activeBracket ? i.bracket_id==activeBracket : true)" :key="standing.id">
                  <tr class="hover:bg-muted/5 transition-colors">
                    <!-- Rank with medal icons for top 3 -->
                    <td class="px-6 py-4">
                      <div class="flex items-center justify-center">
                        <template x-if="index === 0">
                          <div class="flex items-center justify-center w-8 h-8 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full">
                            <i class="fas fa-crown text-white text-sm"></i>
                          </div>
                        </template>
                        <template x-if="index === 1">
                          <div class="flex items-center justify-center w-8 h-8 bg-gradient-to-br from-gray-300 to-gray-500 rounded-full">
                            <i class="fas fa-medal text-white text-sm"></i>
                          </div>
                        </template>
                        <template x-if="index === 2">
                          <div class="flex items-center justify-center w-8 h-8 bg-gradient-to-br from-amber-600 to-amber-800 rounded-full">
                            <i class="fas fa-medal text-white text-sm"></i>
                          </div>
                        </template>
                        <template x-if="index > 2">
                          <span class="font-semibold text-foreground" x-text="index + 1"></span>
                        </template>
                      </div>
                    </td>
                    
                    <!-- Team/User name with bracket badge -->
                    <td class="px-6 py-4">
                      <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0 w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center">
                          <i class="fas fa-user text-primary"></i>
                        </div>
                        <div>
                          <a :href="standing.account_url" 
                             class="font-medium text-foreground hover:text-primary transition-colors" 
                             x-text="standing.name"></a>
                          <template x-if="standing.bracket_name">
                            <div class="mt-1">
                              <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-secondary/10 text-secondary rounded-md" 
                                    x-text="standing.bracket_name"></span>
                            </div>
                          </template>
                        </div>
                      </div>
                    </td>
                    
                    <!-- Score with visual emphasis -->
                    <td class="px-6 py-4 text-center">
                      <div class="font-bold text-lg" 
                           :class="index < 3 ? 'text-primary' : 'text-foreground'" 
                           x-text="standing.score"></div>
                    </td>
                    
                    <!-- Solve count -->
                    <td class="px-6 py-4 text-center">
                      <span class="text-muted-foreground" x-text="standing.solves || '0'"></span>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Empty state with better design -->
      <div class="ctf-card p-12 text-center" x-show="!standings.length">
        <div class="w-16 h-16 bg-muted/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-trophy text-muted-foreground text-2xl"></i>
        </div>
        <h3 class="font-heading font-semibold text-xl text-foreground mb-2">
          {% trans %}No Rankings Yet{% endtrans %}
        </h3>
        <p class="text-muted-foreground">
          {% trans %}The scoreboard will update as participants solve challenges{% endtrans %}
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ Assets.js("assets/js/scoreboard.js") }}
{% endblock %}
