<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <!-- Load Alpine.js for interactive components -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <!-- Load Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Jinja2 for dynamic page title and favicon -->
    <title>{{ title or Configs.ctf_name }}</title>
    <link rel="shortcut icon" href="{{ Configs.ctf_small_icon }}" type="image/x-icon">
    {{ meta | safe }}
    <!-- {{ Configs.theme_header }} -->

    <style>
        :root {
            --blue: #007bff;
            --indigo: #6610f2;
            --purple: #6f42c1;
            --pink: #e83e8c;
            --red: #dc3545;
            --orange: #fd7e14;
            --yellow: #ffc107;
            --green: rgb(159, 239, 0);
            --teal: #20c997;
            --cyan: #17a2b8;
            --white: #fff;
            --gray: #6c757d;
            --gray-dark: #343a40;
            --bg: #0b121f;
            --bg0: #0b121f9678;
            --primary: #007bff;
            --secondary: #6c757d;
            --success: #28a745;
            --info: #17a2b8;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
            --breakpoint-xxxxs: 0;
            --breakpoint-xxxs: 320px;
            --breakpoint-xxs: 375px;
            --breakpoint-xs: 568px;
            --breakpoint-sm: 667px;
            --breakpoint-md: 768px;
            --breakpoint-lg: 992px;
            --p-surface-0: #ffffff;
            --p-slate-50: #f8fafc;
            --p-slate-100: #f1f5f9;
            --p-slate-200: #e2e8f0;
            --p-slate-300: #cbd5e1;
            --p-slate-400: #94a3b8;
            --p-slate-500: #64748b;
            --p-slate-600: #475569;
            --p-slate-700: #334155;
            --p-slate-800: #1e293b;
            --p-slate-900: #0f172a;
            --p-slate-950: #020617;
            --breakpoint-xl: 1200px;
            --breakpoint-xxl: 1440px;
            --font-family-sans-serif: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            --font-family-monospace: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }

        .btn-primary {
            background-color: rgb(159, 239, 0);
            color: black;
            border-radius: 3px;
        }

        .btn-muted {
            background-color: #232e41;
            color: white;
            border-radius: 3px;
        }
    </style>

    <!-- Jinja2 JS variables for client-side logic -->
    <script type="text/javascript">
        window.init = {
            'urlRoot': "{{ request.script_root }}",
            'csrfNonce': "{{ Session.nonce }}",
            'userMode': "{{ Configs.user_mode }}",
            'userId': {{ Session.id }},
            'userName': {{ User.name | tojson }},
            'userEmail': {{ User.email | tojson }},
            'userVerified': {{ User.verified | tojson }},
            'teamId': {{ Team.id | tojson }},
            'teamName': {{ Team.name | tojson }},
            'start': {{ Configs.start | tojson }},
            'end': {{ Configs.end | tojson }},
            'themeSettings': {{ Configs.theme_settings | tojson }},
            'eventSounds': [
                "/themes/core/static/sounds/notification.webm",
                "/themes/core/static/sounds/notification.mp3",
            ],
        }
    </script>
</head>

<body class="text-white bg-[var(--bg)] flex h-screen" x-data="{ mobileMenuOpen: false, avatarMenuOpen: false }">

    <!-- Mobile menu button -->
    <div class="md:hidden fixed top-0 left-0 right-0 z-30 flex justify-between items-center h-20 px-6 bg-[var(--bg)]">
        <a href="/" class="font-bold text-xl">
            {% if Configs.ctf_logo %}
                <img src="{{ Configs.ctf_logo }}" alt="{{ Configs.ctf_name }}" class="h-8">
            {% else %}
                Mile<span class="text-[var(--green)]">Box</span>
            {% endif %}
        </a>
        <button @click="mobileMenuOpen = true" class="text-2xl text-white">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <!-- Sidebar Navigation for Desktop -->
    <aside class="hidden md:flex flex-col min-h-screen w-64 bg-slate-900 border-r border-slate-700 p-6 z-20">
        <!-- Logo -->
        <div class="logo font-bold text-2xl mb-8">
            <a href="/">
                {% if Configs.ctf_logo %}
                    <img src="{{ Configs.ctf_logo }}" alt="{{ Configs.ctf_name }}" class="h-10">
                {% else %}
                    Mile<span class="text-[var(--green)]">Box</span>
                {% endif %}
            </a>
        </div>
        <!-- Main Navigation Links -->
        <ul class="flex flex-col space-y-2 flex-grow">
            <a href="{{ url_for('challenges.listing') }}"
                class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors duration-200 hover:bg-slate-700 hover:text-[var(--green)]">
                <i class="fas fa-flag"></i>
                <span>{% trans %}Challenges{% endtrans %}</span>
            </a>
            <a href="{{ url_for('scoreboard.listing') }}"
                class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors duration-200 hover:bg-slate-700 hover:text-[var(--green)]">
                <i class="fas fa-trophy"></i>
                <span>{% trans %}Scoreboard{% endtrans %}</span>
            </a>
            {% if Session.id %}
            <a href="{{ url_for('teams.private') if Configs.user_mode == 'teams' else url_for('users.private') }}"
                class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors duration-200 hover:bg-slate-700 hover:text-[var(--green)]">
                <i class="fas fa-user-circle"></i>
                <span>{% trans %}Profile{% endtrans %}</span>
            </a>
            <a href="{{ url_for('views.settings') }}"
                class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors duration-200 hover:bg-slate-700 hover:text-[var(--green)]">
                <i class="fas fa-cog"></i>
                <span>{% trans %}Settings{% endtrans %}</span>
            </a>
            {% endif %}
        </ul>
        <!-- User Avatar and Dropdown for logged-in users -->
        <div class="mt-8 pt-4 border-t border-slate-700 flex items-center justify-between">
            {% if Session.id %}
            <div class="flex items-center gap-3">
                <div class="bg-yellow-300 size-10 rounded-full overflow-hidden">
                    <img src="https://api.dicebear.com/8.x/avataaars/svg?seed={{ User.name }}"
                        class="size-full object-cover object-center" alt="User Avatar">
                </div>
                <div>
                    <span class="block font-semibold">{{ User.name }}</span>
                    <span class="block text-sm text-slate-400">
                        {% if Configs.user_mode == 'teams' %}
                            {{ Team.name }}
                        {% else %}
                            User
                        {% endif %}
                    </span>
                </div>
            </div>
            <a href="{{ url_for('auth.logout') }}"
                class="text-slate-400 hover:text-white transition-colors">
                <i class="fas fa-sign-out-alt"></i>
            </a>
            {% else %}
            <!-- Login/Create Account buttons for guests -->
            <div class="flex flex-col gap-3 w-full">
                <a href="{{ url_for('auth.login') }}" class="btn-primary font-semibold block w-full text-center p-3 rounded-md">
                    {% trans %}Login Account{% endtrans %}
                </a>
                <a href="{{ url_for('auth.register') }}" class="btn-muted font-semibold block w-full text-center p-3 rounded-md">
                    {% trans %}Create Account{% endtrans %}
                </a>
            </div>
            {% endif %}
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="md:pl-0 pt-20 md:pt-0 h-screen overflow-y-auto">
        <div class="min-h-screen">
            {% block content %}
            {% endblock %}
        </div>
    </main>

    <!-- Full-screen Mobile Menu (hidden by default) -->
    <div x-show="mobileMenuOpen" x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-x-full" x-transition:enter-end="opacity-100 translate-x-0"
        x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 translate-x-0"
        x-transition:leave-end="opacity-0 translate-x-full" class="fixed inset-0 z-40 bg-slate-900 px-6 py-8"
        style="display: none;">
        <div class="flex justify-between items-center mb-8">
            <a href="/" class="font-bold text-2xl">
                {% if Configs.ctf_logo %}
                    <img src="{{ Configs.ctf_logo }}" alt="{{ Configs.ctf_name }}" class="h-10">
                {% else %}
                    Mile<span class="text-[var(--green)]">Box</span>
                {% endif %}
            </a>
            <button @click="mobileMenuOpen = false" class="text-3xl text-white">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="flex flex-col gap-6 text-xl">
            <a href="{{ url_for('challenges.listing') }}" class="hover:text-[var(--green)] transition-colors">
                {% trans %}Challenges{% endtrans %}
            </a>
            <a href="{{ url_for('scoreboard.listing') }}" class="hover:text-[var(--green)] transition-colors">
                {% trans %}Scoreboard{% endtrans %}
            </a>
            {% if Session.id %}
            <a href="{{ url_for('teams.private') if Configs.user_mode == 'teams' else url_for('users.private') }}" class="hover:text-[var(--green)] transition-colors">
                {% trans %}Profile{% endtrans %}
            </a>
            <a href="{{ url_for('views.settings') }}" class="hover:text-[var(--green)] transition-colors">
                {% trans %}Settings{% endtrans %}
            </a>
            <hr class="border-t border-slate-700" />
            <a href="{{ url_for('auth.logout') }}" class="hover:text-[var(--green)] transition-colors">
                {% trans %}Logout{% endtrans %}
            </a>
            {% else %}
            <hr class="border-t border-slate-700" />
            <a href="{{ url_for('auth.login') }}" class="hover:text-[var(--green)] transition-colors">
                {% trans %}Login Account{% endtrans %}
            </a>
            <a href="{{ url_for('auth.register') }}" class="hover:text-[var(--green)] transition-colors">
                {% trans %}Create Account{% endtrans %}
            </a>
            {% endif %}
        </div>
    </div>

    <!-- {% include "components/notifications.html" %} -->

{% block scripts %}
  {{ Assets.js("assets/js/page.js") }}
{% endblock %}

{{ Plugins.scripts }}

<!-- {{ Configs.theme_footer }} -->
</body>

</html>
