{% extends "base.html" %}

{% block content %}
<!-- Replaced jumbotron with modern hero section and added search/filter functionality -->
<div class="bg-gradient-to-br from-primary/5 to-accent/5 py-16">
  <div class="container mx-auto px-4">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
      <div>
        <h1 class="font-heading font-bold text-4xl text-foreground mb-4">
          {% trans %}Challenges{% endtrans %}
        </h1>
        <p class="text-muted-foreground text-lg">
          {% trans %}Test your skills and solve cybersecurity challenges{% endtrans %}
        </p>
      </div>
      
      <!-- Modern search and filter controls -->
      <div class="mt-6 md:mt-0 flex flex-col sm:flex-row gap-4">
        <div class="relative">
          <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"></i>
          <input type="text" 
                 placeholder="Search challenges..." 
                 class="ctf-input pl-10 w-full sm:w-64"
                 x-data
                 x-model="searchTerm"
                 @input="filterChallenges()">
        </div>
        
        <select class="ctf-input w-full sm:w-auto" x-data x-model="selectedCategory" @change="filterChallenges()">
          <option value="">All Categories</option>
          <template x-for="category in getCategories()" :key="category">
            <option :value="category" x-text="category"></option>
          </template>
        </select>
      </div>
    </div>
  </div>
</div>

<div class="py-8">
  <div class="container mx-auto px-4">
    {% include "components/errors.html" %}

    <div 
      x-data="ChallengeBoard" 
      @load-challenges.window="loadChallenges()" 
      @load-challenge.window="loadChallenge($event.detail)"
    >
      <!-- Modernized modal styling -->
      <div
          x-ref="challengeWindow" 
          id="challenge-window" 
          class="modal fade" 
          tabindex="-1" 
          role="dialog" 
          x-data=""
          x-html="$store.challenge.data.view"
      ></div>

      <!-- Modern loading spinner with better positioning -->
      <div x-show="!loaded" class="flex items-center justify-center min-h-96">
        <div class="text-center">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
          <p class="mt-4 text-muted-foreground">{% trans %}Loading challenges...{% endtrans %}</p>
        </div>
      </div>

      <!-- Redesigned challenges layout with modern cards and better organization -->
      <div x-show="loaded">
        <!-- Challenge statistics overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div class="ctf-card p-6 text-center">
            <div class="text-2xl font-bold text-primary mb-2" x-text="getTotalChallenges()"></div>
            <div class="text-sm text-muted-foreground">{% trans %}Total Challenges{% endtrans %}</div>
          </div>
          <div class="ctf-card p-6 text-center">
            <div class="text-2xl font-bold text-accent mb-2" x-text="getSolvedChallenges()"></div>
            <div class="text-sm text-muted-foreground">{% trans %}Solved{% endtrans %}</div>
          </div>
          <div class="ctf-card p-6 text-center">
            <div class="text-2xl font-bold text-secondary mb-2" x-text="getCategories().length"></div>
            <div class="text-sm text-muted-foreground">{% trans %}Categories{% endtrans %}</div>
          </div>
          <div class="ctf-card p-6 text-center">
            <div class="text-2xl font-bold text-chart-4 mb-2" x-text="getTotalPoints()"></div>
            <div class="text-sm text-muted-foreground">{% trans %}Total Points{% endtrans %}</div>
          </div>
        </div>

        <template x-for="(category, idx) in getCategories()" :key="idx">
          <div class="mb-12">
            <!-- Modern category header with icon and description -->
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
                  <i class="fas fa-flag text-primary"></i>
                </div>
                <div>
                  <h2 class="font-heading font-bold text-2xl text-foreground" x-text="category"></h2>
                  <p class="text-muted-foreground text-sm" x-text="getChallenges(category).length + ' challenges'"></p>
                </div>
              </div>
              
              <!-- Category progress indicator -->
              <div class="hidden md:flex items-center space-x-2">
                <div class="text-sm text-muted-foreground">Progress:</div>
                <div class="w-24 h-2 bg-muted rounded-full overflow-hidden">
                  <div class="h-full bg-accent transition-all duration-300" 
                       :style="`width: ${(getChallengesSolved(category) / getChallenges(category).length) * 100}%`"></div>
                </div>
                <div class="text-sm font-medium text-foreground" 
                     x-text="`${getChallengesSolved(category)}/${getChallenges(category).length}`"></div>
              </div>
            </div>

            <!-- Modern challenge grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
              <template x-for="(c, idx) in getChallenges(category)" :key="c.id">
                <div class="group">
                  <button
                      class="w-full h-full p-6 text-left transition-all duration-200 rounded-lg border-2 hover:shadow-lg hover:-translate-y-1"
                      :class="[
                        c.solved_by_me 
                          ? 'bg-accent/5 border-accent text-accent-foreground shadow-md' 
                          : 'bg-card border-border hover:border-primary/50 text-card-foreground',
                        ...c.tags.map((tag) => `tag-${tag.value.replace(/ /g, '-')}`),
                      ];"
                      :value="c.id" 
                      @click="loadChallenge(c.id)"
                  >
                    <!-- Challenge status indicator -->
                    <div class="flex items-center justify-between mb-4">
                      <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full" 
                             :class="c.solved_by_me ? 'bg-accent' : 'bg-muted'"></div>
                        <span class="text-xs font-medium text-muted-foreground" 
                              x-text="c.solved_by_me ? 'Solved' : 'Unsolved'"></span>
                      </div>
                      
                      <!-- Difficulty indicator -->
                      <div class="flex items-center space-x-1">
                        <template x-for="i in getDifficultyStars(c.value)" :key="i">
                          <i class="fas fa-star text-chart-4 text-xs"></i>
                        </template>
                      </div>
                    </div>

                    <!-- Challenge content -->
                    <div class="space-y-3">
                      <h3 class="font-heading font-semibold text-lg group-hover:text-primary transition-colors" 
                          x-text="c.name"></h3>
                      
                      <div class="flex items-center justify-between">
                        <span class="text-2xl font-bold" 
                              :class="c.solved_by_me ? 'text-accent' : 'text-primary'" 
                              x-text="c.value + ' pts'"></span>
                        
                        <!-- Challenge tags -->
                        <div class="flex flex-wrap gap-1">
                          <template x-for="tag in c.tags.slice(0, 2)" :key="tag.id">
                            <span class="px-2 py-1 text-xs bg-muted text-muted-foreground rounded-md" 
                                  x-text="tag.value"></span>
                          </template>
                        </div>
                      </div>

                      <!-- Solve count -->
                      <div class="flex items-center text-xs text-muted-foreground">
                        <i class="fas fa-users mr-1"></i>
                        <span x-text="c.solves + ' solves'"></span>
                      </div>
                    </div>
                  </button>
                </div>
              </template>
            </div>
          </div>
        </template>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ Assets.js("assets/js/challenges.js") }}
{% endblock %}
