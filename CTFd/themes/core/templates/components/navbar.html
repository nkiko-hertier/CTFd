<!-- Modernized navigation with Tabler UI top navigation design and TailwindCSS -->
<nav class="bg-card border-b border-border shadow-sm sticky top-0 z-50 backdrop-blur-sm bg-card/95">
  <div class="container mx-auto px-4">
    <div class="flex h-16 items-center justify-between">
      <!-- Logo/Brand Section -->
      <div class="flex items-center space-x-4">
        <a href="{{ url_for('views.static_html', route='/') }}" class="flex items-center space-x-2 text-foreground hover:text-primary transition-colors">
          {% if Configs.ctf_logo %}
            <img
                class="h-8 w-auto"
                src="{{ url_for('views.files', path=Configs.ctf_logo) }}"
                alt="{{ Configs.ctf_name }}"
            >
          {% else %}
            <span class="font-heading font-bold text-xl">{{ Configs.ctf_name }}</span>
          {% endif %}
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex md:items-center md:space-x-1">
        <!-- Main Navigation Links -->
        <div class="flex items-center space-x-1">
          {% for page in Plugins.user_menu_pages %}
            <a href="{{ page.route }}" 
               {% if page.link_target %}target="{{ page.link_target }}"{% endif %}
               class="px-3 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
              {{ page.title }}
            </a>
          {% endfor %}

          {% if Configs.account_visibility != 'admins' %}
            <a href="{{ url_for('users.listing') }}" 
               class="px-3 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
              <i class="fas fa-users mr-2"></i>
              {% trans %}Users{% endtrans %}
            </a>

            {% if Configs.user_mode == 'teams' %}
              <a href="{{ url_for('teams.listing') }}" 
                 class="px-3 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
                <i class="fas fa-users-cog mr-2"></i>
                {% trans %}Teams{% endtrans %}
              </a>
            {% endif %}
          {% endif %}

          {% if Configs.account_visibility != 'admins' and Configs.score_visibility != 'admins' %}
            <a href="{{ url_for('scoreboard.listing') }}" 
               class="px-3 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
              <i class="fas fa-trophy mr-2"></i>
              {% trans %}Scoreboard{% endtrans %}
            </a>
          {% endif %}

          <a href="{{ url_for('challenges.listing') }}" 
             class="px-3 py-2 text-sm font-medium text-foreground bg-primary/10 hover:bg-primary/20 rounded-md transition-colors font-semibold">
            <i class="fas fa-flag mr-2"></i>
            {% trans %}Challenges{% endtrans %}
          </a>
        </div>

        <!-- User Menu Section -->
        <div class="flex items-center space-x-2 ml-6 pl-6 border-l border-border">
          {% if authed() %}
            <!-- Admin Panel Link -->
            {% if is_admin() %}
              <a href="{{ url_for('admin.view') }}" 
                 class="p-2 text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors"
                 title="{% trans %}Admin Panel{% endtrans %}">
                <i class="fas fa-wrench"></i>
              </a>
            {% endif %}

            <!-- Notifications -->
            <div class="relative">
              <a href="{{ url_for('views.notifications') }}" 
                 class="p-2 text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors relative"
                 title="{% trans %}Notifications{% endtrans %}">
                <i class="fas fa-bell"></i>
                <span x-data x-show="$store.unread_count > 0" 
                      x-text="$store.unread_count" 
                      class="absolute -top-1 -right-1 bg-destructive text-destructive-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium"></span>
              </a>
            </div>

            <!-- Team Link -->
            {% if Configs.user_mode == "teams" %}
              <a href="{{ url_for('teams.private') }}" 
                 class="p-2 text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors"
                 title="{% trans %}Team{% endtrans %}">
                <i class="fas fa-users"></i>
              </a>
            {% endif %}

            <!-- User Dropdown -->
            <div class="relative" x-data="{ open: false }">
              <button @click="open = !open" 
                      class="flex items-center space-x-2 p-2 text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
                <i class="fas fa-user-circle"></i>
                <i class="fas fa-chevron-down text-xs"></i>
              </button>
              
              <div x-show="open" 
                   @click.away="open = false"
                   x-transition:enter="transition ease-out duration-100"
                   x-transition:enter-start="transform opacity-0 scale-95"
                   x-transition:enter-end="transform opacity-100 scale-100"
                   x-transition:leave="transition ease-in duration-75"
                   x-transition:leave-start="transform opacity-100 scale-100"
                   x-transition:leave-end="transform opacity-0 scale-95"
                   class="absolute right-0 mt-2 w-48 bg-popover border border-border rounded-md shadow-lg py-1 z-50">
                <a href="{{ url_for('users.private') }}" 
                   class="flex items-center px-4 py-2 text-sm text-popover-foreground hover:bg-accent/10 transition-colors">
                  <i class="fas fa-user mr-3"></i>
                  {% trans %}Profile{% endtrans %}
                </a>
                <a href="{{ url_for('views.settings') }}" 
                   class="flex items-center px-4 py-2 text-sm text-popover-foreground hover:bg-accent/10 transition-colors">
                  <i class="fas fa-cogs mr-3"></i>
                  {% trans %}Settings{% endtrans %}
                </a>
                <hr class="my-1 border-border">
                <a href="{{ url_for('auth.logout') }}" 
                   class="flex items-center px-4 py-2 text-sm text-destructive hover:bg-destructive/10 transition-colors">
                  <i class="fas fa-sign-out-alt mr-3"></i>
                  {% trans %}Logout{% endtrans %}
                </a>
              </div>
            </div>
          {% else %}
            <!-- Authentication Links -->
            {% if registration_visible() %}
              <a href="{{ url_for('auth.register') }}" 
                 class="ctf-button-secondary">
                <i class="fas fa-user-plus mr-2"></i>
                {% trans %}Register{% endtrans %}
              </a>
            {% endif %}

            <a href="{{ url_for('auth.login') }}" 
               class="ctf-button-primary">
              <i class="fas fa-sign-in-alt mr-2"></i>
              {% trans %}Login{% endtrans %}
            </a>
          {% endif %}

          <!-- Theme Toggle -->
          {% include "components/theme-switcher.html" %}

          <!-- Language Dropdown -->
          <div class="relative" x-data="{ open: false }">
            <button @click="open = !open" 
                    class="p-2 text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors"
                    title="{% trans %}Change language{% endtrans %}">
              <i class="fas fa-language"></i>
            </button>
            
            <div x-show="open" 
                 @click.away="open = false"
                 x-transition:enter="transition ease-out duration-100"
                 x-transition:enter-start="transform opacity-0 scale-95"
                 x-transition:enter-end="transform opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-75"
                 x-transition:leave-start="transform opacity-100 scale-100"
                 x-transition:leave-end="transform opacity-0 scale-95"
                 class="absolute right-0 mt-2 w-48 bg-popover border border-border rounded-md shadow-lg py-1 z-50">
              <form x-data="LanguageForm">
                {% set curr_lang = get_locale() %}
                {%- for lang in Languages.names.items() %}
                <button type="button" 
                        @click="set" 
                        value="{{ lang[0] }}"
                        class="w-full text-left px-4 py-2 text-sm {{ 'bg-primary text-primary-foreground' if (curr_lang == lang[0]) else 'text-popover-foreground hover:bg-accent/10' }} transition-colors">
                  {{ lang[1] }}
                </button>
                {%- endfor %}
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Menu Button -->
      <div class="md:hidden">
        <button x-data="{ open: false }" 
                @click="open = !open; $refs.mobileMenu.classList.toggle('hidden')"
                class="p-2 text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div x-ref="mobileMenu" class="hidden md:hidden border-t border-border bg-card">
      <div class="px-2 pt-2 pb-3 space-y-1">
        <!-- Mobile Main Links -->
        {% for page in Plugins.user_menu_pages %}
          <a href="{{ page.route }}" 
             {% if page.link_target %}target="{{ page.link_target }}"{% endif %}
             class="block px-3 py-2 text-base font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
            {{ page.title }}
          </a>
        {% endfor %}

        {% if Configs.account_visibility != 'admins' %}
          <a href="{{ url_for('users.listing') }}" 
             class="block px-3 py-2 text-base font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
            <i class="fas fa-users mr-2"></i>
            {% trans %}Users{% endtrans %}
          </a>

          {% if Configs.user_mode == 'teams' %}
            <a href="{{ url_for('teams.listing') }}" 
               class="block px-3 py-2 text-base font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
              <i class="fas fa-users-cog mr-2"></i>
              {% trans %}Teams{% endtrans %}
            </a>
          {% endif %}
        {% endif %}

        {% if Configs.account_visibility != 'admins' and Configs.score_visibility != 'admins' %}
          <a href="{{ url_for('scoreboard.listing') }}" 
             class="block px-3 py-2 text-base font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
            <i class="fas fa-trophy mr-2"></i>
            {% trans %}Scoreboard{% endtrans %}
          </a>
        {% endif %}

        <a href="{{ url_for('challenges.listing') }}" 
           class="block px-3 py-2 text-base font-medium text-foreground bg-primary/10 hover:bg-primary/20 rounded-md transition-colors font-semibold">
          <i class="fas fa-flag mr-2"></i>
          {% trans %}Challenges{% endtrans %}
        </a>

        <!-- Mobile User Section -->
        {% if authed() %}
          <div class="border-t border-border pt-4 mt-4">
            {% if is_admin() %}
              <a href="{{ url_for('admin.view') }}" 
                 class="block px-3 py-2 text-base font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
                <i class="fas fa-wrench mr-2"></i>
                {% trans %}Admin Panel{% endtrans %}
              </a>
            {% endif %}

            <a href="{{ url_for('views.notifications') }}" 
               class="block px-3 py-2 text-base font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
              <i class="fas fa-bell mr-2"></i>
              {% trans %}Notifications{% endtrans %}
              <span x-data x-show="$store.unread_count > 0" 
                    x-text="$store.unread_count" 
                    class="ml-2 bg-destructive text-destructive-foreground text-xs rounded-full px-2 py-1 font-medium"></span>
            </a>

            {% if Configs.user_mode == "teams" %}
              <a href="{{ url_for('teams.private') }}" 
                 class="block px-3 py-2 text-base font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
                <i class="fas fa-users mr-2"></i>
                {% trans %}Team{% endtrans %}
              </a>
            {% endif %}

            <a href="{{ url_for('users.private') }}" 
               class="block px-3 py-2 text-base font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
              <i class="fas fa-user mr-2"></i>
              {% trans %}Profile{% endtrans %}
            </a>

            <a href="{{ url_for('views.settings') }}" 
               class="block px-3 py-2 text-base font-medium text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors">
              <i class="fas fa-cogs mr-2"></i>
              {% trans %}Settings{% endtrans %}
            </a>

            <a href="{{ url_for('auth.logout') }}" 
               class="block px-3 py-2 text-base font-medium text-destructive hover:bg-destructive/10 rounded-md transition-colors">
              <i class="fas fa-sign-out-alt mr-2"></i>
              {% trans %}Logout{% endtrans %}
            </a>
          </div>
        {% else %}
          <div class="border-t border-border pt-4 mt-4 space-y-2">
            {% if registration_visible() %}
              <a href="{{ url_for('auth.register') }}" 
                 class="block w-full text-center ctf-button-secondary">
                <i class="fas fa-user-plus mr-2"></i>
                {% trans %}Register{% endtrans %}
              </a>
            {% endif %}

            <a href="{{ url_for('auth.login') }}" 
               class="block w-full text-center ctf-button-primary">
              <i class="fas fa-sign-in-alt mr-2"></i>
              {% trans %}Login{% endtrans %}
            </a>
          </div>
        {% endif %}

        <!-- Mobile Theme and Language -->
        <div class="border-t border-border pt-4 mt-4 flex justify-between">
          <!-- Theme Switcher -->
          {% include "components/theme-switcher.html" %}

          <!-- Language Dropdown -->
          <div class="relative" x-data="{ open: false }">
            <button @click="open = !open" 
                    class="p-2 text-muted-foreground hover:text-foreground hover:bg-accent/10 rounded-md transition-colors"
                    title="{% trans %}Change language{% endtrans %}">
              <i class="fas fa-language"></i>
            </button>
            
            <div x-show="open" 
                 @click.away="open = false"
                 x-transition:enter="transition ease-out duration-100"
                 x-transition:enter-start="transform opacity-0 scale-95"
                 x-transition:enter-end="transform opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-75"
                 x-transition:leave-start="transform opacity-100 scale-100"
                 x-transition:leave-end="transform opacity-0 scale-95"
                 class="absolute right-0 mt-2 w-48 bg-popover border border-border rounded-md shadow-lg py-1 z-50">
              <form x-data="LanguageForm">
                {% set curr_lang = get_locale() %}
                {%- for lang in Languages.names.items() %}
                <button type="button" 
                        @click="set" 
                        value="{{ lang[0] }}"
                        class="w-full text-left px-4 py-2 text-sm {{ 'bg-primary text-primary-foreground' if (curr_lang == lang[0]) else 'text-popover-foreground hover:bg-accent/10' }} transition-colors">
                  {{ lang[1] }}
                </button>
                {%- endfor %}
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>
